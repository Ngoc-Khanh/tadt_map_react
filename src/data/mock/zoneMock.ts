import type { IGeometry, IZone, IZoneGeometry, IZoneWithGeometry } from "@/data/interfaces";

// Dictionary chứa geometry data theo zone_id
export const zonesGeometryDict: Record<string, IZoneGeometry> = {
  "35cc4f5b-dcab-4349-83fc-c6aae6611a3c": {
    geometry: [
      {
        type: "Polygon",
        coordinates: [
          [103.99486041377, 10.07426895148, 0],
          [103.99485628876, 10.07428184892, 0],
          [103.99485229378, 10.07429478649, 0],
          [103.99484842924, 10.07430776292, 0],
          [103.99484469552, 10.0743207769, 0],
          [103.99484109299, 10.07433382715, 0],
          [103.994837622, 10.07434691237, 0],
          [103.99483428291, 10.07436003125, 0],
          [103.99483107604, 10.07437318249, 0],
          [103.99482800172, 10.07438636478, 0],
          [103.99482506025, 10.0743995768, 0],
          [103.99482225193, 10.07441281725, 0],
          [103.99481957702, 10.0744260848, 0],
          [103.99481703581, 10.07443937814, 0],
          [103.99481462854, 10.07445269594, 0],
          [103.99481235545, 10.07446603688, 0],
          [103.99481021677, 10.07447939963, 0],
          [103.99480821271, 10.07449278285, 0],
          [103.99480634347, 10.07450618522, 0],
          [103.99480460924, 10.0745196054, 0],
          [103.99480301018, 10.07453304206, 0],
          [103.99480154647, 10.07454649387, 0],
          [103.99480021823, 10.07455995947, 0],
          [103.99479902562, 10.07457343753, 0],
          [103.99479796874, 10.07458692671, 0],
          [103.9947970477, 10.07460042567, 0],
          [103.99479626259, 10.07461393307, 0],
          [103.99479561349, 10.07462744755, 0],
          [103.99479510047, 10.07464096778, 0],
          [103.99479472357, 10.07465449241, 0],
          [103.99479448284, 10.07466802009, 0],
          [103.99479437829, 10.07468154948, 0],
          [103.99479440994, 10.07469507923, 0],
          [103.99479457778, 10.07470860799, 0],
          [103.9947948818, 10.07472213442, 0],
          [103.99479532197, 10.07473565717, 0],
          [103.99479589825, 10.0747491749, 0],
          [103.99479661057, 10.07476268625, 0],
          [103.99479745886, 10.0747761899, 0],
          [103.99479844305, 10.07478968448, 0],
          [103.99479956303, 10.07480316866, 0],
          [103.99480081869, 10.0748166411, 0],
          [103.99480220991, 10.07483010045, 0],
          [103.99480373654, 10.07484354538, 0],
          [103.99480539845, 10.07485697455, 0],
          [103.99480719545, 10.07487038662, 0],
          [103.99480912738, 10.07488378026, 0],
          [103.99481119403, 10.07489715413, 0],
          [103.99481339521, 10.07491050691, 0],
          [103.99481339521, 10.07491050691, 0],
          [103.99485543165, 10.07515775071, 0],
          [103.99480760007, 10.07516637311, 0],
          [103.99474098908, 10.07517773415, 0],
          [103.99467417235, 10.07518783922, 0],
          [103.99460717399, 10.07519668468, 0],
          [103.99454001817, 10.07520426733, 0],
          [103.99447272912, 10.07521058445, 0],
          [103.99440533113, 10.07521563374, 0],
          [103.99433784851, 10.0752194134, 0],
          [103.99427030563, 10.07522192205, 0],
          [103.99420272685, 10.07522315879, 0],
          [103.99413513656, 10.07522312318, 0],
          [103.99406755914, 10.07522181522, 0],
          [103.99400001899, 10.07521923539, 0],
          [103.99393254048, 10.07521538461, 0],
          [103.99386514795, 10.07521026429, 0],
          [103.99379786572, 10.07520387627, 0],
          [103.99373071808, 10.07519622284, 0],
          [103.99366372926, 10.07518730679, 0],
          [103.99359692342, 10.07517713131, 0],
          [103.99353032468, 10.07516570008, 0],
          [103.99346395706, 10.07515301724, 0],
          [103.99339784452, 10.07513908734, 0],
          [103.99333201091, 10.07512391543, 0],
          [103.99326647999, 10.07510750698, 0],
          [103.9932012754, 10.0750898679, 0],
          [103.99313642069, 10.07507100457, 0],
          [103.99307193923, 10.07505092379, 0],
          [103.99300785432, 10.0750296328, 0],
          [103.99294418907, 10.07500713929, 0],
          [103.99288096645, 10.07498345137, 0],
          [103.99281820928, 10.0749585776, 0],
          [103.9927559402, 10.07493252695, 0],
          [103.99269418169, 10.07490530882, 0],
          [103.99263295603, 10.07487693303, 0],
          [103.99257228532, 10.07484740982, 0],
          [103.99251219144, 10.07481674985, 0],
          [103.99245269608, 10.07478496417, 0],
          [103.99239382071, 10.07475206426, 0],
          [103.99233558658, 10.07471806199, 0],
          [103.9922780147, 10.07468296964, 0],
          [103.99222112584, 10.07464679985, 0],
          [103.99216494053, 10.07460956569, 0],
          [103.99210947905, 10.07457128059, 0],
          [103.9920547614, 10.07453195837, 0],
          [103.99200080734, 10.07449161321, 0],
          [103.99194763634, 10.07445025968, 0],
          [103.99189526757, 10.0744079127, 0],
          [103.99184371994, 10.07436458754, 0],
          [103.99179301204, 10.07432029985, 0],
          [103.99179301204, 10.07432029985, 0],
          [103.9916552715, 10.0741976757, 0],
          [103.99164182577, 10.07418574216, 0],
          [103.99162834345, 10.07417384923, 0],
          [103.99161482467, 10.07416199702, 0],
          [103.99160126955, 10.07415018565, 0],
          [103.99158767822, 10.07413841521, 0],
          [103.9915740508, 10.07412668583, 0],
          [103.99156038742, 10.0741149976, 0],
          [103.99154668821, 10.07410335064, 0],
          [103.99153295329, 10.07409174505, 0],
          [103.99151918279, 10.07408018095, 0],
          [103.99150537684, 10.07406865843, 0],
          [103.99149153557, 10.07405717761, 0],
          [103.9914776591, 10.0740457386, 0],
          [103.99146374757, 10.07403434149, 0],
          [103.9914498011, 10.07402298639, 0],
          [103.99143581981, 10.07401167342, 0],
          [103.99142180385, 10.07400040266, 0],
          [103.99140775334, 10.07398917424, 0],
          [103.99139366841, 10.07397798825, 0],
          [103.9913795492, 10.07396684479, 0],
          [103.99136539582, 10.07395574397, 0],
          [103.99135120842, 10.0739446859, 0],
          [103.99133698712, 10.07393367067, 0],
          [103.99132273206, 10.07392269838, 0],
          [103.99130844336, 10.07391176915, 0],
          [103.99129412117, 10.07390088306, 0],
          [103.99127976561, 10.07389004022, 0],
          [103.99126537682, 10.07387924073, 0],
          [103.99125095492, 10.0738684847, 0],
          [103.99123650006, 10.07385777221, 0],
          [103.99122201237, 10.07384710338, 0],
          [103.99120749198, 10.07383647829, 0],
          [103.99119293902, 10.07382589704, 0],
          [103.99117835363, 10.07381535975, 0],
          [103.99116373595, 10.07380486649, 0],
          [103.99114908612, 10.07379441738, 0],
          [103.99113440425, 10.0737840125, 0],
          [103.99111969051, 10.07377365195, 0],
          [103.99110494501, 10.07376333583, 0],
          [103.99109016789, 10.07375306424, 0],
          [103.9910753593, 10.07374283727, 0],
          [103.99106051937, 10.07373265501, 0],
          [103.99104564824, 10.07372251756, 0],
          [103.99103074604, 10.07371242501, 0],
          [103.99101581292, 10.07370237745, 0],
          [103.991000849, 10.07369237499, 0],
          [103.99098585444, 10.07368241771, 0],
          [103.99097082937, 10.0736725057, 0],
          [103.99097082937, 10.0736725057, 0],
          [103.99043153628, 10.07331790695, 0],
          [103.99046632385, 10.07328899765, 0],
          [103.99049266727, 10.073267382, 0],
          [103.99051928118, 10.07324609426, 0],
          [103.99054616142, 10.07322513774, 0],
          [103.99057330379, 10.07320451571, 0],
          [103.99060070405, 10.07318423141, 0],
          [103.99062835794, 10.07316428799, 0],
          [103.99065626112, 10.07314468857, 0],
          [103.99068440924, 10.07312543621, 0],
          [103.99071279791, 10.07310653391, 0],
          [103.9907414227, 10.07308798464, 0],
          [103.99077027913, 10.07306979127, 0],
          [103.9907993627, 10.07305195666, 0],
          [103.99082866886, 10.07303448359, 0],
          [103.99085819305, 10.07301737478, 0],
          [103.99088793065, 10.07300063291, 0],
          [103.99091787703, 10.0729842606, 0],
          [103.99094802749, 10.07296826039, 0],
          [103.99097837734, 10.07295263479, 0],
          [103.99100892183, 10.07293738624, 0],
          [103.99103965621, 10.07292251711, 0],
          [103.99107057566, 10.07290802973, 0],
          [103.99110167536, 10.07289392637, 0],
          [103.99113295046, 10.07288020922, 0],
          [103.99116439607, 10.07286688042, 0],
          [103.99119600728, 10.07285394206, 0],
          [103.99122777915, 10.07284139616, 0],
          [103.99125970674, 10.07282924467, 0],
          [103.99129178504, 10.07281748949, 0],
          [103.99132400905, 10.07280613246, 0],
          [103.99135637374, 10.07279517536, 0],
          [103.99138887406, 10.07278461988, 0],
          [103.99142150493, 10.07277446769, 0],
          [103.99145426126, 10.07276472036, 0],
          [103.99148713792, 10.07275537942, 0],
          [103.9915201298, 10.07274644633, 0],
          [103.99155323174, 10.07273792248, 0],
          [103.99158643856, 10.0727298092, 0],
          [103.99161974509, 10.07272210775, 0],
          [103.99165314612, 10.07271481935, 0],
          [103.99168663644, 10.07270794513, 0],
          [103.99172021082, 10.07270148616, 0],
          [103.99175386402, 10.07269544345, 0],
          [103.99178759078, 10.07268981795, 0],
          [103.99182138583, 10.07268461053, 0],
          [103.99185524391, 10.072679822, 0],
          [103.99188915972, 10.07267545312, 0],
          [103.99192312796, 10.07267150456, 0],
          [103.99195714334, 10.07266797695, 0],
          [103.99195714334, 10.07266797695, 0],
          [103.9924317915, 10.07262172171, 0],
          [103.99244846185, 10.07262006651, 0],
          [103.99246512595, 10.07261835064, 0],
          [103.99248178358, 10.07261657413, 0],
          [103.99249843452, 10.072614737, 0],
          [103.99251507853, 10.07261283928, 0],
          [103.9925317154, 10.072610881, 0],
          [103.9925483449, 10.07260886217, 0],
          [103.9925649668, 10.07260678282, 0],
          [103.99258158089, 10.072604643, 0],
          [103.99259818693, 10.07260244271, 0],
          [103.99261478471, 10.072600182, 0],
          [103.99263137399, 10.07259786089, 0],
          [103.99264795456, 10.07259547942, 0],
          [103.9926645262, 10.07259303761, 0],
          [103.99268108867, 10.0725905355, 0],
          [103.99269764176, 10.07258797312, 0],
          [103.99271418524, 10.07258535052, 0],
          [103.99273071889, 10.07258266771, 0],
          [103.99274724249, 10.07257992475, 0],
          [103.99276375581, 10.07257712166, 0],
          [103.99278025863, 10.07257425849, 0],
          [103.99279675072, 10.07257133527, 0],
          [103.99281323187, 10.07256835204, 0],
          [103.99282970186, 10.07256530884, 0],
          [103.99284616045, 10.07256220572, 0],
          [103.99286260744, 10.07255904272, 0],
          [103.99287904259, 10.07255581987, 0],
          [103.99289546568, 10.07255253722, 0],
          [103.9929118765, 10.07254919482, 0],
          [103.99292827482, 10.07254579271, 0],
          [103.99294466043, 10.07254233094, 0],
          [103.99296103309, 10.07253880955, 0],
          [103.99297739259, 10.07253522859, 0],
          [103.99299373871, 10.07253158811, 0],
          [103.99301007123, 10.07252788816, 0],
          [103.99302638992, 10.07252412879, 0],
          [103.99304269457, 10.07252031005, 0],
          [103.99305898496, 10.07251643198, 0],
          [103.99307526087, 10.07251249466, 0],
          [103.99309152208, 10.07250849811, 0],
          [103.99310776836, 10.07250444241, 0],
          [103.99312399951, 10.0725003276, 0],
          [103.99314021529, 10.07249615374, 0],
          [103.9931564155, 10.07249192089, 0],
          [103.99317259991, 10.0724876291, 0],
          [103.99318876831, 10.07248327844, 0],
          [103.99320492047, 10.07247886895, 0],
          [103.99322105618, 10.0724744007, 0],
          [103.99322105618, 10.0724744007, 0],
          [103.99376076541, 10.07232388629, 0],
          [103.99377595994, 10.07231960188, 0],
          [103.99379112926, 10.07231523063, 0],
          [103.99380627287, 10.07231077268, 0],
          [103.99382139027, 10.07230622819, 0],
          [103.99383648094, 10.0723015973, 0],
          [103.9938515444, 10.07229688016, 0],
          [103.99386658013, 10.07229207695, 0],
          [103.99388158763, 10.07228718781, 0],
          [103.99389656641, 10.0722822129, 0],
          [103.99391151597, 10.0722771524, 0],
          [103.9939264358, 10.07227200648, 0],
          [103.99394132541, 10.0722667753, 0],
          [103.99395618431, 10.07226145903, 0],
          [103.993971012, 10.07225605786, 0],
          [103.99398580798, 10.07225057197, 0],
          [103.99400057177, 10.07224500154, 0],
          [103.99401530287, 10.07223934675, 0],
          [103.99403000078, 10.07223360779, 0],
          [103.99404466503, 10.07222778485, 0],
          [103.99405929512, 10.07222187813, 0],
          [103.99407389057, 10.07221588783, 0],
          [103.99408845088, 10.07220981414, 0],
          [103.99410297557, 10.07220365727, 0],
          [103.99411746417, 10.07219741741, 0],
          [103.99413191618, 10.07219109479, 0],
          [103.99414633113, 10.07218468961, 0],
          [103.99416070853, 10.07217820207, 0],
          [103.99417504791, 10.07217163241, 0],
          [103.99418934879, 10.07216498084, 0],
          [103.99420361068, 10.07215824757, 0],
          [103.99421783313, 10.07215143284, 0],
          [103.99423201565, 10.07214453687, 0],
          [103.99424615777, 10.0721375599, 0],
          [103.99426025901, 10.07213050214, 0],
          [103.99427431892, 10.07212336384, 0],
          [103.99428833702, 10.07211614524, 0],
          [103.99430231284, 10.07210884658, 0],
          [103.99431624592, 10.07210146809, 0],
          [103.9943301358, 10.07209401003, 0],
          [103.99434398201, 10.07208647265, 0],
          [103.99435778409, 10.07207885619, 0],
          [103.99437154157, 10.07207116091, 0],
          [103.99438525401, 10.07206338706, 0],
          [103.99439892095, 10.07205553491, 0],
          [103.99441254193, 10.07204760471, 0],
          [103.99442611649, 10.07203959674, 0],
          [103.99443964419, 10.07203151125, 0],
          [103.99445312457, 10.07202334851, 0],
          [103.99445312457, 10.07202334851, 0],
          [103.99472424916, 10.07255368392, 0],
          [103.99474074895, 10.07258662022, 0],
          [103.99475670591, 10.07261981815, 0],
          [103.99477211582, 10.07265326894, 0],
          [103.9947869746, 10.07268696374, 0],
          [103.99480127832, 10.07272089362, 0],
          [103.99481502319, 10.0727550496, 0],
          [103.99482820557, 10.07278942266, 0],
          [103.99484082198, 10.07282400368, 0],
          [103.99485286908, 10.07285878352, 0],
          [103.99486434367, 10.07289375298, 0],
          [103.99487524273, 10.07292890279, 0],
          [103.99488556336, 10.07296422366, 0],
          [103.99489530284, 10.07299970624, 0],
          [103.99490445859, 10.07303534114, 0],
          [103.99491302818, 10.07307111893, 0],
          [103.99492100935, 10.07310703014, 0],
          [103.99492839998, 10.07314306526, 0],
          [103.99493519811, 10.07317921476, 0],
          [103.99494140196, 10.07321546908, 0],
          [103.99494700987, 10.07325181861, 0],
          [103.99495202036, 10.07328825374, 0],
          [103.99495643211, 10.07332476482, 0],
          [103.99496024395, 10.0733613422, 0],
          [103.99496345487, 10.07339797619, 0],
          [103.99496606401, 10.07343465709, 0],
          [103.99496807069, 10.07347137521, 0],
          [103.99496947438, 10.07350812081, 0],
          [103.99497027471, 10.07354488419, 0],
          [103.99497047145, 10.0735816556, 0],
          [103.99497006457, 10.07361842531, 0],
          [103.99496905417, 10.07365518361, 0],
          [103.99496744051, 10.07369192074, 0],
          [103.99496522403, 10.07372862701, 0],
          [103.9949624053, 10.07376529268, 0],
          [103.99495898508, 10.07380190806, 0],
          [103.99495496426, 10.07383846345, 0],
          [103.99495034392, 10.07387494919, 0],
          [103.99494512528, 10.07391135561, 0],
          [103.99493930971, 10.07394767308, 0],
          [103.99493289876, 10.07398389199, 0],
          [103.99492589413, 10.07402000276, 0],
          [103.99491829765, 10.07405599582, 0],
          [103.99491011136, 10.07409186165, 0],
          [103.9949013374, 10.07412759076, 0],
          [103.99489197811, 10.0741631737, 0],
          [103.99488203596, 10.07419860104, 0],
          [103.99487151359, 10.07423386341, 0],
          [103.99486041377, 10.07426895148, 0],
          [103.99486041377, 10.07426895148, 0],
        ],
        properties: {
          name: "Polygon_001",
          description: "RANHGIOI",
        },
      },
    ],
  },
};

// Hàm tạo geometry ngẫu nhiên nếu không tìm thấy zone_id
const generateRandomGeometry = (): IGeometry[] => {
  const baseLat = 21.0285 + Math.random() * 0.01;
  const baseLng = 105.8342 + Math.random() * 0.01;
  const size = 0.001 + Math.random() * 0.005;
  
  return [{
    type: "Polygon",
    coordinates: [
      [baseLng, baseLat, 0],
      [baseLng + size, baseLat, 0],
      [baseLng + size, baseLat + size, 0],
      [baseLng, baseLat + size, 0],
      [baseLng, baseLat, 0]
    ],
    properties: {
      name: "Generated_Polygon",
      description: "RANHGIOI"
    }
  }];
}

// Hàm chính để thêm geometry vào zone data
export const getZoneWithGeometry = (zoneData: IZone): IZoneWithGeometry => {
  return {
    ...zoneData,
    geometry: zonesGeometryDict[zoneData.zone_id]?.geometry || generateRandomGeometry()
  };
}

// Hàm xử lý array zones
export const addGeometryToZones = (zones: IZone[]): IZoneWithGeometry[] => {
  return zones.map((zone: IZone) => getZoneWithGeometry(zone));
}

// Hàm kiểm tra zone có geometry hay không
export const hasGeometry = (zoneId: string): boolean => {
  return !!zonesGeometryDict[zoneId];
}

// Hàm lấy geometry theo zone_id
export const getGeometryByZoneId = (zoneId: string): IGeometry[] | null => {
  return zonesGeometryDict[zoneId]?.geometry || null;
}

// Hàm tạo zone data hoàn chỉnh từ API response
export const createZoneFromApi = (apiResponse: IZone | IZone[]): IZoneWithGeometry[] => {
  // Nếu apiResponse là array
  if (Array.isArray(apiResponse)) return addGeometryToZones(apiResponse);
  // Nếu apiResponse là single object
  return [getZoneWithGeometry(apiResponse)];
}